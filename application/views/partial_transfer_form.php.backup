<div class="panel panel-default">
	<div class="panel-heading">
		<h3 class="panel-title" ng-if="!transferItem.id">New Transfer</h3>
		<h3 class="panel-title" ng-if="transferItem.id">Transfer #{{ transferItem.id }}</h3>
	</div>
	<div class="panel-body">
		<div class="row">
			<div class="col-sm-6 col-md-8 col-lg-9">
				<!-- Source -->
				<div class="form-group" ng-switch on="mode">
					<label class="control-label">Source</label>
					
					<div class="input-group" ng-switch-when="externalReceipt">
						<div class="input-group-btn">
							<button type="button" class="btn btn-default" ng-click="toggleSource()">
								<i class="glyphicon glyphicon-refresh"></i>
							</button>
						</div>
						<select class="form-control"
								ng-model="data.sourceStore"
								ng-options="store.store_name for store in originStores track by store.id"
								ng-show="!data.externalSource" ng-change="changeSource()">
						</select>
						<input type="text" class="form-control" placeholder="Enter name of external source"
								ng-model="transferItem.origin_name"
								ng-show="data.externalSource">
					</div>
					
					<div ng-switch-default>
						<p class="form-control-static">{{ transferItem.origin_name }}</p>
					</div>
					
				</div>
				
				<!-- Destination -->
				<div class="form-group" ng-switch on="mode">
					<label class="control-label">{{ destinationLabel }}</label>
					
					<div class="input-group" ng-switch-when="transfer">
						<div class="input-group-btn">
							<button type="button" class="btn btn-default" ng-click="toggleDestination()">
								<i class="glyphicon glyphicon-refresh"></i>
							</button>
						</div>
						<select class="form-control"
								ng-model="data.destinationStore"
								ng-options="store.store_name for store in destinationStores track by store.id"
								ng-show="!data.externalDestination" ng-change="changeDestination()">
						</select>
						<input type="text" class="form-control" placeholder="Enter name of external destination"
								ng-model="transferItem.destination_name"
								ng-show="data.externalDestination">
					</div>
					
					<div ng-switch-default>
						<p class="form-control-static">{{ transferItem.destination_name }}</p>
					</div>
				</div>
			</div>
			
			<div class="col-sm-6 col-md-4 col-lg-3">
				<!-- Date of Transfer -->
				<div class="form-group" ng-switch on="mode">
					<label class="control-label">Date of Transfer</label>
					
					<div class="input-group" ng-switch-when="transfer">
						<input type="text" class="form-control" uib-datepicker-popup="{{ format }}" is-open="transferDatepicker.opened"
							min-date="minDate" max-date="maxDate" datepicker-options="dateOptions" date-disabled="disabled(date, mode)"
							ng-model="transferItem.transfer_datetime" ng-required="true" close-text="Close" alt-input-formats="altInputFormats" />
						<span class="input-group-btn">
							<button type="button" class="btn btn-default" ng-click="showDatePicker( 'transfer' )"><i class="glyphicon glyphicon-calendar"></i></button>
						</span>
					</div>
					
					<div ng-switch-default>
						<p class="form-control-static">{{ transferItem.transfer_datetime | date: 'yyyy-MM-dd HH:mm:ss' }}</p>
					</div>
				</div>
				
				<!-- Transfer Status -->
				<div class="form-group">
					<label class="control-label">Status</label>
					<p class="form-control-static">{{ lookupTransferStatus( transferItem.transfer_status ) }}</p>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Transfer items table -->
<div class="panel panel-default">
	<div class="panel-heading">
		<h3 class="panel-title pull-left">Transfer Items</h3>
		<div class="pull-right" ng-if="mode == 'transfer'">
			<button class="btn btn-default btn-sm" ng-click="addTransferItem()">
				<i class="glyphicon glyphicon-plus"></i> Add item
			</button>
		</div>
		<div class="clearfix"></div>
	</div>
	<table class="table table-condensed" ng-switch on="mode">
		<thead>
			<tr>
				<th class="text-center col-sm-1">Row</th>
				<th class="text-left col-sm-4">Item</th>
				<th class="text-right col-sm-2">Quantity</th>
				<th class="text-left col-sm-4">Remarks</th>
				<th></th>
			</tr>
		</thead>
		<tbody ng-switch-when="transfer">
			<tr ng-repeat="row in transferItem.items" ng-class="{ deleted: row.deleted }">
				<td class="text-center">
					{{ $index + 1 }}
				</td>
				<td class="text-left">
					<select class="form-control"
							ng-disabled="row.deleted"
							ng-init="row.selectedItem = { item_id: row.item_id }"
							ng-change="changeItem(row)"
							ng-model="row.selectedItem"
							ng-options="item.item_description for item in items track by item.item_id">
					</select>
				</td>
				<td class="text-right">
					<input type="number" class="form-control text-right" ng-model="row.quantity" ng-disabled="row.deleted">
				</td>
				<td class="text-left">
					<input type="text" class="form-control" ng-model="row.remarks" ng-disabled="row.deleted">
				</td>
				<td class="text-center">
					<a href ng-click="removeItem( row )">
						<i class="glyphicon glyphicon-remove-circle"></i> Remove
					</a>
				</td>
			</tr>
			<tr ng-show="!transferItem.items.length">
				<td colspan="5" class="text-center">No item for this transfer</td>
			</tr>
		</tbody>
		<tbody ng-switch-default>
			<tr ng-repeat="row in transferItem.items">
				<td class="text-center">{{ $index + 1 }}</td>
				<td class="text-left">{{ row.item_description }}</td>
				<td class="text-right">{{ row.quantity | number }}</td>
				<td class="text-left">{{ row.remarks }}</td>
				<td class="text-center"></td>
			</tr>
			<tr ng-show="!transferItem.items.length">
				<td colspan="5" class="text-center">No item for this transfer</td>
			</tr>
		</tbody>
	</table>
</div>

<div class="row">	
	<div class="col-sm-6">
		<div class="panel panel-default">
			<div class="panel-heading">
				<h3 class="panel-title">Sender Information</h3>
			</div>
			<div class="panel-body">
				<form>
					<!-- Other Information -->
					<div class="form-group" ng-switch on="mode">
						<label class="control-label">Person-in-Charge</label>
						<input type="text" class="form-control" placeholder="Name of person-in-charge of transfer"
								ng-model="transferItem.sender_name" ng-switch-when="transfer">
						<p class="form-control-static" ng-switch-default>{{ transferItem.sender_name }}</p>
					</div>
					<div class="form-group">
						<label class="control-label">Prepared by</label>
						<p class="form-control-static">{{ user.full_name }}</p>
					</div>
				</form>
			</div>
		</div>
	</div>
	<div class="col-sm-6">
		<div class="panel panel-default">
			<div class="panel-heading">
				<h3 class="panel-title">Receipt Details</h3>
			</div>
			<div class="panel-body">
				<form>
					<!-- Date of Receipt -->
					<div class="form-group" ng-switch on="mode">
						<label class="control-label">Date of Receipt</label>
						<div class="input-group" ng-switch-when="receipt">
							<input type="text" class="form-control" uib-datepicker-popup="{{format}}"
									ng-model="transferItem.receipt_datetime" is-open="receiptDatepicker.opened"
									min-date="minDate" max-date="maxDate" datepicker-options="dateOptions" date-disabled="disabled(date, mode)"
									ng-required="true" close-text="Close" alt-input-formats="altInputFormats" />
							<span class="input-group-btn">
								<button type="button" class="btn btn-default" ng-click="showDatePicker( 'receipt' )"><i class="glyphicon glyphicon-calendar"></i></button>
							</span>
						</div>
						<p class="form-control-static" ng-switch-default>{{ transferItem.receipt_datetime }}</p>
					</div>
					
					<!-- Other Information -->
					<div class="form-group" ng-switch on="mode">
						<label class="control-label">Recipient</label>
						<input type="text" class="form-control" ng-switch-when="receipt" placeholder="Name of recipient" ng-model="tranferItem.recipient_name">
						<p class="form-control-static" ng-switch-default>{{ transferItem.recipient_name }}</p>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>

<div class="text-right" ng-switch on="mode">
	<div ng-switch-when="transfer">
		<button type="button" class="btn btn-primary" ng-click="scheduleTransfer()">Schedule</button>
		<button type="button" class="btn btn-default" ng-click="approveTransfer()">Approve</button>
		<button type="button" class="btn btn-default" ui-sref="store">Cancel</button>
	</div>
	<div ng-switch-when="receipt">
		<button type="button" class="btn btn-primary" ng-click="receiveTransfer()">Receive</button>
		<button type="button" class="btn btn-default" ui-sref="store">Cancel</button>
	</div>
	<div ng-switch-default>
		<button type="button" class="btn btn-default" ui-sref="store">Close</button>
	</div>
</div>